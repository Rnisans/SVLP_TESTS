[TOC]


## Описание

Программное обеспечение для контроллера электронной нагрузки на STM32F103C8T6.

Данная электронная нагрузка применяется для испытания и оценки емкости АКБ.

Для дистанционного контроля и подключения к ПК для дальнейшей передачи данных имеется интерфейс USB.

Контролирует ток, напряжение на АКБ и температуру АКБ. 



## Характеричтики
 - Напряжение пост. до 30 В,
 - Ток до 30 А,
 - Мощность до 900 Вт,
 - Интерфейс USB,
 - Защита от перегрева (OTP), перегрузки по току (ОСР)
 - Выключение нагрузки при низком напряжении на АКБ (настраивается).


## Библиотеки
 - STM32_USB-FS-Device_Driver
 - svlp_common_lib


## Вкладки интрефейса

 1. Главная вкладка (main)

Только на этой вкладке можно запустить нагрузку.
 - Для запуска нагрузки необходимо нажать на энкодр и повернуть его вправо.  
 - Для выключения нагрузки необходимо нажать на энкодр и повернуть его влево.

Отображает текущие:
 - Состояние нагрузки (Запущена/Остановлена)
 - Время работы
 - Температура 
 - Напряжение 
 - Ток
 - Мощьность
 - Измереная емкость
 
 2. Результат работы (info)

Вкладка для отображения результата работы нагрузки:
 - Время работы после запуска нагрузки и до момента выключения
 - Емкость в ампер часах (Ah)
 - Емкость в ватт часах (Wh)
 - Макмимальная и минимальная мощьность в ваттах (Wt)
 - Напряжение, Ток и Температура по окончанию разряда
 
Мониторинг начинается после запуске нагрузки (Run).

 3. Настройки (sett)

Вкладка для изменения настроек:
 - prTemp температура при превышение которой сработает защита и нагрузка отключится
 - prCurr ток при превышение которого нагрузка отключится
 - prVolt напряжение ниже которого нагрузка отключится (если BMS не отработает)

Так же отображает offset для датчиков тока и напряжения.

 4. График напряжения при разряде (volt)

На данной вкладке отображается график напряжения при разряде АКБ.  

Мониторинг начинается после запуске нагрузки (Run).


## Схема подключения

1. Энкодер

 - S1  -> PA9
 - S2  -> PA8
 - KEY -> PA7
 - VCC -> +3.3


2. Экран (OLED 1,3" 128*64 I2C)

 - SCL -> PB6
 - SDA -> PB7
 - VCC -> +3.3


3. Датчик тока ACS758

 - OUT2 через резисторный делитель 1/3 (4.7КОм и 9.3КОм) к пину PA0
 - VCC  -> +5В.

    Подключен к 5В так как на 3.3 работает нестабильно.


4. Датчик температуры DS18B20

 - DATA -> PB11
 - VCC  -> +3.3


5. Напряжение

    Напряжение мониторим через резисторный делитель 1/10 (10КОм и 90Ком) подключенный к пину РА2


6. Реле (24В, 40А)

    Управляется через транзистор IRLML0060TR (N-MOSFET 60В 2.7А 1.25Вт) подключенный к PB12.
Drain транзистора подтянут к земле резистором 10К Ом и соединен с пином PB12 через резистор 100 Ом.



## Сборка проекта


Для сборки проекта использовалась программа CooCox IDE (Version: 1.7.6) и компилятор GNU Tools ARM Embedded 6.2 2016q4.


Процесс сборки:


 - Открыть CooCox IDE


 - Перейти в вкладку "Project" и нажать "Open Project...".


 - Перейти в папку с проектом и выбрать .coproj файл.


 - Для сборки проекта надо перейти в вкладку "Project" и нажать "Rebuild".




Подключение svlp_common_lib:


 - Перейти в вкладку "View" и нажать "Configuration".


 - В открывшемся окне перейти в вкладку "Compile". В блоке "Includepaths" указать путь к папке библиотеки.  

    Например: D:\Projects\electronic_load\svlp_common_lib\svlp_lib

Далее перейти в вкладку "Link". 

 - В блоке "Linked Libraries" указать путь к файлу библиотеки.
 
    Например: D:\Projects\electronic_load\svlp_common_lib\lib\arm